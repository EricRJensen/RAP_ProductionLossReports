---
title: "`r params$new_title`"
params:
  new_title: params$new_title
  main_df: params$main_df
  cty_sf: params$cty_sf
  sta_sf: params$sta_sf
  sta_ctys_sf: params$sta_ctys_sf
  range_sta_ctys_sf: params$range_sta_ctys_sf
  forest_sta_ctys_sf: params$forest_sta_ctys_sf
  current_year: params$current_year
  rap_url: params$rap_url
  main_dir: params$main_dir
  type: params$type
output:
  html_document:
    toc: true
    toc_float:
      collapsed: false
---


<style type="text/css">

@import url('https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,300;1,400;1,500;1,600;1,700;1,800&display=swap');

body{ /* Normal  */
      font-family: 'Open Sans', sans-serif;
      color: #2b2b2b;
  }

.table-span{
  display: inline-block;
  width: 80%;
  margin-left:10%;
}

table.table-main {
  vertical-align: middle;
}

table.table-main thead th{
  padding: 0.8rem;
  font-size:2.25rem;
}

table.table-main tbody td{
  padding: 0.8rem;
  font-size:2rem;
}

.title{
    display: none;
}

.caption {
  font-style: italic;
}

.leaflet {
  z-index:1;
}

.header {
  display: inline-block;
  text-align: left;
  color: black;
  background-color:white;
  margin-left: -325px;
  padding-left: 0;
  position: fixed;
  z-index:3;
  height:225px;
}

.header-title {
  position: absolute;
  top: 16px;
  left: 16px;
  font-size: 6rem;
  font-weight: bold;
  text-shadow: 0 0 10px #FFFFFF, 0 0 20px #FFFFFF, 0 0 30px #FFFFFF, 0 0 40px #FFFFFF;
}

.header-subtitle {
  position: absolute;
  bottom: 30px;
  left: 16px;
  font-size: 3rem;
  font-weight: 500;
  text-shadow: 0 0 10px #FFFFFF, 0 0 20px #FFFFFF, 0 0 30px #FFFFFF, 0 0 40px #FFFFFF;
}

.content{
  position:absolute;
  margin-top:225px;
  height:400px
}

#TOC{
  margin-top:225px;
}


</style>


```{r setup, include=FALSE}
library(here)
library(tidyverse)
library(sf)
library(knitr)
require(scales)
library(reshape2)
library(leaflet)
library(leaflet.extras)
library(kableExtra)
library(patchwork)
library(htmltools)
library(htmlwidgets)
library(bsplus)
library(tableHTML)

knitr::opts_chunk$set(echo = TRUE, root.dir = here())
```

```{r cache = FALSE, echo = F, warning = F, message = F}
message(getwd())
```


```{r echo = FALSE, warning = FALSE}
htmltools::HTML(paste('<span class="header">
                          <img src = "./Assets/Banner.jpg" height = "200px">
                          <div class="header-title">',
                      params$new_title,
                      '</div>
                          <div class="header-subtitle">Tree expansion and rangeland productivity report</div>
                       </span>', sep = ''))
```

<div class = "content">
```{r echo = FALSE, warning = FALSE}
home_path = ifelse(params$type == 'County', '../../index.html', '../index.html')
state_path = ifelse(params$type == 'County', '../index.html', 'index.html')
state_name = ifelse(grepl(",", params$new_title) == TRUE, paste('>', str_split(params$new_title, ',')[[1]][2]), paste('>',params$new_title))
cty_name = ifelse(params$type == 'County', paste('>', str_split(loc_name, ',')[[1]][1], sep = ' '), '')

home_path = ifelse(params$type == 'County', '../../index.html', '../index.html')
state_path = ifelse(params$type == 'County', '../index.html', 'index.html')
state_name = ifelse(grepl(",", params$new_title) == TRUE, paste('>', str_split(params$new_title, ',')[[1]][2]), paste('>',params$new_title))

state_link = ifelse(params$type == 'County', 
                    paste('-- [', str_split(params$new_title, ',')[[1]][2], '](../index.html)', ' -- '),
                    paste('--',params$new_title))

cty_name = ifelse(params$type == 'County', str_split(loc_name, ',')[[1]][1], '')
```
#### [Home](`r home_path`) `r state_link` `r cty_name`

<div style="margin-bottom:30px;">
</div>

<!-- > ##### ***[Click here to download this report as a PDF.](./index.pdf)*** -->

# Rangeland production gains/losses
### Production loss key statistics
```{r echo = FALSE, warning = FALSE}
main_df_rec <- params$main_df %>%
  filter(year == params$current_year) 

htmltools::HTML(paste(
  '<span class="table-span">
    <table class="table-main">
      <thead>
        <tr>',
      ifelse(sum(-params$main_df$yieldgap) < 0,
          paste('<th style="background-color:#FF000088; border: 3px solid black"><center>', sep = ''), paste('<th style="background-color:#FFFFFF; border: 3px solid black"><center>', sep = '')),
          'Total production gains/losses (1990-', params$current_year, ')</th></center>',
      ifelse(-main_df_rec$yieldgap < 0,
          paste('<th style="background-color:#FF000088; border: 3px solid black"><center>', sep = ''), paste('<th style="background-color:#FFFFFF; border: 3px solid black"><center>', sep = '')),
          'Production gains/losses in ', params$current_year, '</h2></th></center>
        </tr>
      </thead>
      <tbody>
        <tr>',
      ifelse(sum(params$main_df$yieldgap) > 0,
          paste('<td style="background-color:#FF000044; border: 3px solid black"><center>', sep = ''), paste('<td style="background-color:#FFFFFF; border: 3px solid black"><center>', sep = '')),
          ifelse(sum(params$main_df$yieldgap) > 0,
                 paste(format(round(-sum(params$main_df$yieldgap),0), big.mark = ','), ' tons', sep = ''), paste('+', format(round(-sum(params$main_df$yieldgap),0), big.mark = ','), ' tons', sep = '')),
          '</td></center>',
      ifelse(main_df_rec$yieldgap > 0,
          paste('<td style="background-color:#FF000044; border: 3px solid black"><center>', sep = ''), paste('<td style="background-color:#FFFFFF; border: 3px solid black"><center>', sep = '')),
          ifelse(main_df_rec$yieldgap > 0, paste(format(round(-main_df_rec$yieldgap,0), big.mark = ','), ' tons', sep = ''), paste('+', format(round(-main_df_rec$yieldgap,0), big.mark = ','), ' tons', sep = '')),
          '</td></center>
        </tr>
      </tbody>
    </table>
  </span>',
sep = ''))
```
  
<div style="margin-bottom:30px;">
</div>
  
### Production loss map
Click any county on the map below to access its report.
```{r echo = FALSE, warning = FALSE, fig.width=10, fig.cap=paste("The map above depicts percent production loss in", params$current_year, "relative to what would have been achievable had tree cover not changed since 1990. Counties that appear red have had the most production losses in the state as a result of tree cover increases.")}

# --------- Preliminaries -----------

# Get list of county paths
sta_ctys_sf <- params$sta_ctys_sf

# Scale ranges and palettes for controlling data visualization
# Vector
# Define color ramp -- adjusting bias factor to bias more colors for higher values and stretch color ramp to non-forest counties
rampcols<- colorRampPalette(c("#ffffff","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"), space = "Lab", bias = 2)(max(params$range_sta_ctys_sf$yieldgap_curYear_norm)*1000)
pal <- colorNumeric(rampcols, domain = c(0, max(range_ctys_sf$yieldgap_curYear_norm)), na.color = '#ffffff')

# Functions to generate labels
labs <- lapply(seq(nrow(sta_ctys_sf)), function(i) {
      lab<- paste0('<b>', sta_ctys_sf[i, "NAMELSAD"], '</b><br>',
                   paste(as.character(format(round(as.numeric(sta_ctys_sf[i, "yieldgap_curYear"]), 0), big.mark = ',')), ' tons (', round(as.numeric(sta_ctys_sf[i, "yieldgap_curYear_norm"]), 1), '%) production loss in ', params$current_year, '<br>', sep = ''))
      lab[1]})

# Zoom level to control map display
zoom_level = params$sta_sf$zoom %>% unlist()

# On-click functionality 
cty_paths <- if (params$type == 'County'){sta_ctys_sf$up_path
  } else if (params$type == 'State') {sta_ctys_sf$dn_path}

# Concatenate the Javascript string by looping over each county feature in the state
jsOnClick_srt <- paste('
  function(el, x) {
    var marker = document.getElementsByClassName("leaflet-interactive");')

jsOnClick_mid <- as.character('')
for(i in 1:length(cty_paths)){
  url = cty_paths[i]
  i_js = i-1
  js_str <- paste('marker[', i_js, '].onclick=function(){window.open(\"', url, '\", \"_self\");};', sep = '')
  jsOnClick_mid <- paste(jsOnClick_mid, js_str)
}

jsOnClick_end <- '}'

jsOnClick <- paste(jsOnClick_srt, jsOnClick_mid, jsOnClick_end, sep = '')


# ---------- Mapping -----------

if (params$type == 'County'){
  leaflet(options = leafletOptions(zoomControl = FALSE,  minZoom = zoom_level, maxZoom = zoom_level, dragging = FALSE, attributionControl=FALSE)) %>%
      #Map layers
      addMapPane("labs", zIndex = 490) %>%
      addMapPane("forest_mask", zIndex = 410) %>%
      addMapPane("forest_polys", zIndex = 420) %>%
      addMapPane("range_polys", zIndex = 430) %>%
      addMapPane("sta_outline", zIndex = 440) %>%
      addMapPane("cty_outline", zIndex = 450) %>%
      # County polygons with labels and on-click
      addPolygons(data = params$sta_ctys_sf,
                  fillOpacity = 0,
                  opacity = 0,
                  options = pathOptions(pane = "labs"),
                  label = lapply(labs, htmltools::HTML),
                  labelOptions = labelOptions(style = list(
                    "box-shadow" = "3px 3px rgba(0,0,0,0.25)",
                    "font-size" = "13px",
                    "margin" = "0px"))) %>%
      #County mask
      addPolygons(data = params$forest_sta_ctys_sf,
                  fillColor = 'grey',
                  fillOpacity = 1,
                  color = '#2b2b2b',
                  options = pathOptions(pane = "forest_mask")) %>%
      #County choropleths
      addPolygons(data = params$forest_sta_ctys_sf,
                  fillColor = ~pal(yieldgap_curYear_norm),
                  color = '#2b2b2b',
                  weight = 1,
                  opacity = 1,
                  fillOpacity = .4,
                  options = pathOptions(pane = "forest_polys")) %>%
      addPolygons(data = params$range_sta_ctys_sf,
                  fillColor = ~pal(yieldgap_curYear_norm),
                  color = '#2b2b2b',
                  weight = 1,
                  opacity = 1,
                  fillOpacity = 1,
                  options = pathOptions(pane = "range_polys")) %>%
      # State polygon
      addPolylines(data = params$sta_sf,
                   fillColor = '#FFFFFFFF',
                   color = '#424242',
                   fillOpacity = 0,
                   opacity = 1,
                   weight = 2,
                   options = pathOptions(pane = "sta_outline")) %>%
      # County polyline
      addPolylines(data = params$cty_sf,
                  color = '#2471B2',
                  weight = 4,
                  opacity = 1,
                  stroke = TRUE,
                  smoothFactor = 0.5,
                  options = pathOptions(pane = "cty_outline"),
                  labelOptions = labelOptions(style = list(
                    "box-shadow" = "3px 3px rgba(0,0,0,0.25)",
                    "font-size" = "13px",
                    "margin" = "0px"))) %>%
      addLegend(position = "bottomright", pal = pal, values = c(0, max(params$range_sta_ctys_sf$yieldgap_curYear_norm)),
                title = paste("Production<br>loss in ", params$current_year),
                opacity = 1,
                labFormat = labelFormat(suffix = '%'),
                na.label = '') %>%
      setMapWidgetStyle(list(background = "white")) %>%
      htmlwidgets::onRender(jsOnClick) %>%
    htmlwidgets::onRender("(function(){
        var originalInitTile = L.GridLayer.prototype._initTile
        L.GridLayer.include({
            _initTile: function (tile) {
                originalInitTile.call(this, tile);

                var tileSize = this.getTileSize();

                tile.style.width = tileSize.x + 1 + 'px';
                tile.style.height = tileSize.y + 1 + 'px';
                  }
              });
          })()")

} else if (params$type == 'State') {
    leaflet(options = leafletOptions(zoomControl = FALSE,  minZoom = zoom_level, maxZoom = zoom_level, dragging = FALSE, attributionControl=FALSE)) %>%
      #Map layers
      addMapPane("labs", zIndex = 490) %>%
      addMapPane("forest_mask", zIndex = 410) %>%
      addMapPane("forest_polys", zIndex = 420) %>%
      addMapPane("range_polys", zIndex = 430) %>%
      addMapPane("sta_outline", zIndex = 440) %>%
      # County polygons with labels and on-click
      addPolygons(data = params$sta_ctys_sf,
                  fillOpacity = 0,
                  opacity = 0,
                  options = pathOptions(pane = "labs"),
                  label = lapply(labs, htmltools::HTML),
                  labelOptions = labelOptions(style = list(
                    "box-shadow" = "3px 3px rgba(0,0,0,0.25)",
                    "font-size" = "13px",
                    "margin" = "0px"))) %>%
      #County mask
      addPolygons(data = params$forest_sta_ctys_sf,
                  fillColor = 'grey',
                  fillOpacity = 1,
                  color = '#2b2b2b',
                  options = pathOptions(pane = "forest_mask")) %>%
      #County choropleths
      addPolygons(data = params$forest_sta_ctys_sf,
                  fillColor = ~pal(yieldgap_curYear_norm),
                  color = '#2b2b2b',
                  weight = 1,
                  opacity = 1,
                  fillOpacity = .4,
                  options = pathOptions(pane = "forest_polys")) %>%
      addPolygons(data = params$range_sta_ctys_sf,
                  fillColor = ~pal(yieldgap_curYear_norm),
                  color = '#2b2b2b',
                  weight = 1,
                  opacity = 1,
                  fillOpacity = 1,
                  options = pathOptions(pane = "range_polys")) %>%
      # State polygon
      addPolylines(data = params$sta_sf,
                   fillColor = '#FFFFFFFF',
                   color = '#424242',
                   fillOpacity = 0,
                   opacity = 1,
                   weight = 2,
                   options = pathOptions(pane = "sta_outline")) %>%
      addLegend(position = "bottomright", pal = pal, values = c(0, max(params$range_sta_ctys_sf$yieldgap_curYear_norm)),
                title = paste("Production<br>loss in ", params$current_year),
                labFormat = labelFormat(suffix = '%'),
                opacity = 1,
                na.label = '') %>%
      setMapWidgetStyle(list(background = "white")) %>%
      htmlwidgets::onRender(jsOnClick) %>%
    htmlwidgets::onRender("(function(){
        var originalInitTile = L.GridLayer.prototype._initTile
        L.GridLayer.include({
            _initTile: function (tile) {
                originalInitTile.call(this, tile);

                var tileSize = this.getTileSize();

                tile.style.width = tileSize.x + 1 + 'px';
                tile.style.height = tileSize.y + 1 + 'px';
                  }
              });
          })()")
}
  
```


<div style="margin-bottom:50px;">
</div>

### Production loss plots
*The plots below depict herbaceous production gains/losses resulting from tree cover change on an annually (left) and cumulatively (right) for the period of 1990-`r as.character(params$current_year)`. The annual plot displays the same information as the map above.*
```{r echo = FALSE, fig.width=10}
annYG_plot <- ggplot()+
  geom_line(params$main_df, mapping = aes(x = year, y = -yieldgap), color = 'red', size = 1)+
  geom_point(params$main_df, mapping = aes(x = year, y = -yieldgap), color = 'red', size = 2)+
  geom_hline(yintercept = 0, linetype = 'dashed', color = 'grey30', size = 1)+
  labs(title = 'Annual herbaceous production gains/losses', y = 'Production gains/losses (tons)')+
  coord_cartesian(ylim = c(-(max(abs(params$main_df$yieldgap)))*1.1,(max(abs(params$main_df$yieldgap)))*1.1))+
  scale_y_continuous(labels = comma)+
  scale_x_continuous(breaks = scales::pretty_breaks(n = 10)) +
  theme_minimal()+
  theme(axis.title.x=element_blank(),
        plot.title.position = "plot")

cumYG_plot <- ggplot()+
  geom_line(params$main_df, mapping = aes(x = year, y = -cumYieldGap), color = 'red', size = 1)+
  geom_point(params$main_df, mapping = aes(x = year, y = -cumYieldGap), color = 'red', size = 2)+
  geom_hline(yintercept = 0, linetype = 'dashed', color = 'grey30', size = 1)+
  labs(title = 'Cumulative herbaceous production gains/losses', y = 'Production gains/losses (tons)')+
  coord_cartesian(ylim = c((-max(abs(params$main_df$cumYieldGap)))*1.1,(max(abs(params$main_df$cumYieldGap)))*1.1))+
  scale_y_continuous(labels = comma)+
  scale_x_continuous(breaks = scales::pretty_breaks(n = 10)) +
  theme_minimal()+
  theme(axis.title.x=element_blank(),
        plot.title.position = "plot")

(annYG_plot | cumYG_plot)
```

|
|
### Production and tree cover summary
```{r echo = FALSE, warning = FALSE}
# Statistics for report
figure_v <- c("See supplemental data",
              "[See figure](#herbaceous-production-gainslosses)", 
              "[See figure](#herbaceous-production-gainslosses)",
              "See supplemental data", 
              "See supplemental data", 
              "", 
              "")
main_df_rec <- params$main_df %>%
  filter(year == params$current_year) 

stat_df <- tibble(init = 10)
stat_df[, paste('Herbaceous production in', as.character(params$current_year))] = paste(as.character(round(main_df_rec$biomass,0)), 'tons')
prodChangeCum <- -round(main_df_rec$yieldgap,0)
prodChangePct <- -round(main_df_rec$yieldgap / (main_df_rec$yieldgap + main_df_rec$biomass)*100,2)
stat_df[, paste('Herbaceous production gains/losses in', as.character(params$current_year))] <- ifelse(prodChangeCum >= 0, paste('+', as.character(prodChangeCum), ' tons (+', prodChangePct, '%)', sep = ''), paste('-', as.character(prodChangeCum), ' tons (-', prodChangePct, '%)', sep = ''))
prodChangeCur <- -round(sum(params$main_df$yieldgap),0)
stat_df[, paste('Herbaceous production gains/losses since 1990')] <- ifelse(prodChangeCur >= 0, paste('+', as.character(prodChangeCur), ' tons', sep = ''), paste('-', as.character(prodChangeCur), ' tons', sep = '')) 
stat_df[, paste('Tree cover in', as.character(params$current_year))] <- paste(as.character(round(main_df_rec$treeArea,0)), 'acres')
treeAreaChange <- round((tail(params$main_df$treeArea, n = 1)) - (head(params$main_df$treeArea, n = 1)), 0)
stat_df[, paste('Tree cover change since 1990')] <- ifelse(treeAreaChange >= 0, paste('+', as.character(treeAreaChange), ' acres', sep = ''), paste('-', as.character(treeAreaChange), ' acres', sep = ''))
stat_df[, paste('Tree cover percent in', as.character(params$current_year))] <- paste(as.character(round(main_df_rec$treeCover,2)),'%', sep = '')
treePctChange <- round((tail(params$main_df$treeCover, n = 1)) - (head(params$main_df$treeCover, n = 1)), 2)
stat_df[, paste('Tree cover percent change since 1990')] <- ifelse(treePctChange >= 0, paste('+', as.character(treePctChange), '%', sep = ''), paste('-', as.character(treePctChange), '%', sep = ''))

stat_df <- stat_df[,2:8]

stat_df <- stat_df %>%
  t() %>%
  melt() %>%
  mutate(Figure = figure_v[row_number()],
         Value = prettyNum(value, big.mark = ",")) %>%
  dplyr::select(c(Variable = Var1, Value, Figure))

kable(stat_df, col.names = NULL) %>%
  column_spec(1, width = "15cm") %>%
  column_spec(2, width = "5cm") %>%
  column_spec(3, width = "5cm") %>%
  row_spec(1:6, hline_after = TRUE) %>%
  kable_styling()
```

<div style="margin-bottom:30px;">
</div>

# Rangeland vulnerability to trees   
### Vulnerability to trees plot
*The plot below depicts annual trends in intact and at-risk rangeland classes for the period of 1990-`r as.character(params$current_year)`. See the state map in the "Rangeland vulnerability to trees" supplemental section below* `r bs_button("?") %>% bs_attach_modal(id_modal = "modalVulnerability")`
```{r echo = FALSE, warning = FALSE, fig.width=10}
bs_modal(id = "modalVulnerability",
         title = "Rangeland vulnerability classes",
         body = htmltools::HTML(paste("
         <p>The <i>Rangeland vulnerability</i> layer in the State map and the <i>Rangeland vulnerability</i> plot depict the same information in slightly different ways.</p>
         <br>
         <p>The classes are described below:</p>
         <p align='center'>
         <img src='./Assets/Vulnerability.png' width='300px'>
         </p>
         <ul>
         <li><b>Intact rangeland:</b> Areas with less than 3% tree cover and *outside of* a dispersal range of 200 meters of any area with greater than 3% tree cover.</li>
         <li><b>Intact rangeland, at risk:</b> Areas with less than 3% tree cover, but *within* a dispersal range of 200 meters of any area with greater than 3% tree cover.</li>
         <li><b>Low/moderate tree cover:</b> Areas with 3-20% tree cover.</li>
         <li><b>Forest/Woodland:</b> Areas with greater than 20% tree cover. These areas include primary forest, as well as woodlands and invaded rangelands.</li>
         <br>
         <p>These vulnerability classes are based on the schmatic outlined in the Working Lands for Wildlife's Great Plains Framework for Conservation Action. <a href = 'https://wlfw.rangelands.app/assets/greatPlainsFramework.pdf#page=15' target='_blank'> Learn more here.</a></p>", sep = '')))

plot_df <- params$main_df %>%
  dplyr::select(c(year, `At-risk` = classAtRisk, Intact = classIntact)) %>%
  melt(id = 'year')

ggplot()+
  geom_bar(plot_df, mapping = aes(fill = variable, x = year, y = value), colour="grey30", size = 0.75, width = 1, position = position_dodge(width = 1), stat = "identity")+
  labs(y = 'Area (acres)', title = '')+
  scale_fill_manual(
        values = c(
          `At-risk` = "#FDE64B",
          Intact = "#00B050"))+
  scale_y_continuous(labels = comma)+
  theme_minimal()+
  theme(legend.title = element_blank(),
        legend.position="bottom",
        axis.title.x=element_blank(),
        plot.title.position = "plot")
```

<div style="margin-bottom:30px;">
</div>

|
# Supplemental data
```{r, warning = FALSE, message = FALSE, echo = FALSE}
htmltools::HTML(paste('<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="false">
  <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="headingOne">
      <h4 class="panel-title">
        <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
          Annual data table
        </a>
      </h4>
    </div>
    <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
      <div class="panel-body">
        <object type="text/html" data="./data.html" width=800 height=975></object>
        <br>
        <p><a href="data.csv">Download data table as CSV</a></p>
      </div>
    </div>
  </div>
  <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="headingTwo">
      <h4 class="panel-title">
        <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
          Herbaceous production plot
        </a>
      </h4>
    </div>
    <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
      <div class="panel-body">
        <img src="',
        paste(params$main_dir, 'production.png', sep = ''),
        '">
      </div>
    </div>
  </div>
  <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="headingThree">
      <h4 class="panel-title">
        <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
          Tree cover plot
        </a>
      </h4>
    </div>
    <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
      <div class="panel-body">
        <img src="',
        paste(params$main_dir, 'tree.png', sep = ''),
      '">
      </div>
    </div>
  </div>
  <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="headingFour">
      <h4 class="panel-title">
        <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
          Rangeland vulnerability map
        </a>
      </h4>
    </div>
    <div id="collapseFour" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingFour">
      <div class="panel-body"><img src="',
      ifelse(params$type == 'State', paste(params$main_dir, 'vuln.png', sep = ''), paste(sta_dir, 'vuln.png', sep = '')),
      '">
      </div>
    </div>
  </div>
  <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="headingFive">
      <h4 class="panel-title">
        <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseFive" aria-expanded="false" aria-controls="collapseFive">
          Analysis area
        </a>
      </h4>
    </div>
    <div id="collapseFive" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingFive">
      <div class="panel-body">
        <p>These reports estimate herbaceous production changes for less intensively modified areas across the western US and, thus, exclude some land cover types from analysis.</p>
        <p>The values in the table below are:</p>
        <ul>
          <li><b>Total area:</b> The total area of the state or county covered by the report.</li>
          <li><b>Analysis area:</b> The land area used to generate the data found in this report. All land cover classes were included in this analysis except 1) cultivated and 2) developed lands as labeled in the National Land Cover Database
            (2016) (NLCD) and the National Agricultural Statistics Service (NASS) Cropland Data Layers</li>
          <li><b>Area excluded from analysis:</b> The land area removed from this analysis. Specifically, this is the total area labeled as 1) cultivated and 2) developed lands by the NLCD and NASS datasets.</li>
        </ul>
        <object type="text/html" data="./poly_data.html" width=800 height=180></object>
      </div>
    </div>
  </div>
</div>',
sep = ''))


```


<div style="margin-bottom:35px;">
</div>

# Reference
Access the complete data from which this report is derived:  

* [View tree cover data in the Rangeland Analysis Platform web application](`r params$rap_url`){target="_blank"}
* [Download this report as a PDF.](./index.pdf)
* [Download the CSV for this report.](./data.csv)  

  
*Report generated on `r Sys.Date()`.*

<div style="margin-bottom:35px;">
</div>
</div>
<div class="tocify-extend-page" data-unique="tocify-extend-page" style="height: 30px;"></div>